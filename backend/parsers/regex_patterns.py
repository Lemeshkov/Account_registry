# backend/parsers/regex_patterns.py

# Счёт № 1-2676 от 18 декабря 2025 г.
INVOICE_NUMBER_DATE = (
    r"сч[её]т\s*(?:на\s*оплату\s*)?"
    r"№\s*([\w\-\/]+)\s*от\s*([0-9]{1,2}\s+[а-яА-Я]+\s+[0-9]{4})"
)

# Поставщик: ООО "Автоскан-Сервис"
# Захватываем всё до ИНН или конца строки
SUPPLIER_RE = r"(?:поставщик|исполнитель)\s*[:\-]?\s*(.+?)(?:\s+ИНН|$|\n)"

# ИНН
INN = r"\bИНН\s*[:№]?\s*(\d{10,12})\b"

# Расчетный счет
ACCOUNT = r"\bр\/?с\s*[:№]?\s*(\d{20})\b"

# Итого
TOTAL = r"(?:итого|всего\s*к\s*оплате)\s*[:=]?\s*([\d\s.,]+)"

# НДС
VAT = r"(?:ндс\s*\(?\d+%?\)?)[^\d]*([\d\s.,]+)"

# Для отдельных полей
INVOICE_NUMBER_RE = r"сч[её]т\s*№?\s*([A-ZА-Я0-9\-\/]+)"
INVOICE_DATE_RE = r"от\s*(\d{1,2}\s+[а-яё]+\s+\d{4})"

# -------------------------------------------------
# Строки счета (позиции)
# -------------------------------------------------

INVOICE_LINE_RE = (
    r"(\d+)\s+"                       # № позиции
    r"(.+?)\s+"                       # описание
    r"(\d+)\s+"                       # количество
    r"(?:ШT|ШТ|WT)?\s+"               # единица (опционально)
    r"([\d\s]+,\d{2})\s+"             # цена
    r"([\d\s]+,\d{2})"                # сумма
    r"(?=\s+\d+\s+|$)"                # следующая позиция или конец
)